<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Bible Archive</title>
    <style>
        body {
            margin: 0;
            background-color: #0a0a0a;
            background-image: 
              linear-gradient(rgba(255,255,255,.05) 1px, transparent 1px),
              linear-gradient(90deg, rgba(255,255,255,.05) 1px, transparent 1px);
            background-size: 50px 50px;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #eee;
            font-family: 'Georgia', serif;
            overflow: hidden;
        }

        .container {
            max-width: 900px;
            width: 95%;
            height: 90vh;
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 50px rgba(0,0,0,0.6);
        }

        header {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }

        select, button {
            background: #1a1a1a;
            color: #fff;
            border: 1px solid #444;
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        button:hover { background: #333; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }

        #reader-output {
            flex-grow: 1;
            overflow-y: auto;
            padding: 40px;
            scroll-behavior: smooth;
        }

        h1 { margin-top: 0; font-size: 2.5rem; letter-spacing: -1px; }

        .verse { margin-bottom: 12px; display: inline; line-height: 1.9; }
        .v-num { 
            color: #666; 
            font-weight: bold; 
            font-size: 0.75rem; 
            margin-right: 8px; 
            margin-left: 12px;
            vertical-align: super;
        }

        footer {
            padding: 15px 40px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #status { font-size: 0.85rem; transition: color 0.3s; }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <select id="bookSelect" onchange="resetChapterAndLoad()"></select>
        <div style="display:flex; align-items:center; gap:5px;">
            <button onclick="changeChapter(-1)">‹</button>
            <span id="chapterLabel" style="min-width: 80px; text-align: center;">Chapter 1</span>
            <button onclick="changeChapter(1)">›</button>
        </div>
    </header>

    <div id="reader-output">
        <h1 id="passageTitle">The Bible</h1>
        <div id="textContent">Loading...</div>
    </div>

    <footer>
        <small id="status">World English Bible (Public Domain)</small>
        <div id="navigation">
            <button onclick="changeChapter(-1)">Previous</button>
            <button onclick="changeChapter(1)">Next</button>
        </div>
    </footer>
</div>

<script>
    const bibleBooks = [
        "Genesis", "Exodus", "Leviticus", "Numbers", "Deuteronomy", "Joshua", "Judges", "Ruth", "1 Samuel", "2 Samuel", "1 Kings", "2 Kings", "1 Chronicles", "2 Chronicles", "Ezra", "Nehemiah", "Esther", "Job", "Psalms", "Proverbs", "Ecclesiastes", "Song of Solomon", "Isaiah", "Jeremiah", "Lamentations", "Ezekiel", "Daniel", "Hosea", "Joel", "Amos", "Obadiah", "Jonah", "Micah", "Nahum", "Habakkuk", "Zephaniah", "Haggai", "Zechariah", "Malachi", "Matthew", "Mark", "Luke", "John", "Acts", "Romans", "1 Corinthians", "2 Corinthians", "Galatians", "Ephesians", "Philippians", "Colossians", "1 Thessalonians", "2 Thessalonians", "1 Timothy", "2 Timothy", "Titus", "Philemon", "Hebrews", "James", "1 Peter", "2 Peter", "1 John", "2 John", "3 John", "Jude", "Revelation"
    ];

    let currentBook = "Genesis";
    let currentChapter = 1;

    // Rate Limiter variables
    let lastRequestTime = 0;
    const COOLDOWN_MS = 1000; // 1 second minimum between API calls

    // Initialize dropdown
    const select = document.getElementById('bookSelect');
    bibleBooks.forEach(book => {
        const opt = document.createElement('option');
        opt.value = book;
        opt.innerText = book;
        select.appendChild(opt);
    });

    async function loadBible() {
        const now = Date.now();
        const content = document.getElementById('textContent');
        const title = document.getElementById('passageTitle');
        const label = document.getElementById('chapterLabel');
        const status = document.getElementById('status');

        // Client-side rate limiting logic
        if (now - lastRequestTime < COOLDOWN_MS) {
            status.innerText = "Wait a second, dont wanna get ip banned from the api!";
            status.style.color = "#ffcc00";
            return;
        }

        lastRequestTime = now;
        status.innerText = "Fetching...";
        status.style.color = "#888";
        content.innerHTML = "Fetching text...";
        label.innerText = `Chapter ${currentChapter}`;

        try {
            const response = await fetch(`https://bible-api.com/${currentBook}+${currentChapter}`);
            
            // Handle server-side rate limiting (HTTP 429)
            if (response.status === 429) {
                status.innerText = "Limit reached. Try again later.";
                status.style.color = "#ff4444";
                content.innerHTML = "Low-key your spamming my api. stop dawg.";
                return;
            }

            const data = await response.json();

            if (data.text) {
                title.innerText = `${currentBook} ${currentChapter}`;
                content.innerHTML = data.verses.map(v => 
                    `<span class="verse"><span class="v-num">${v.verse}</span>${v.text}</span>`
                ).join('');
                document.getElementById('reader-output').scrollTop = 0;
                
                // Reset status after success
                status.innerText = "World English Bible (Public Domain)";
                status.style.color = "#888";
            } else {
                content.innerHTML = "End of book. Use the selector to move to the next book.";
            }
        } catch (err) {
            content.innerHTML = "Error loading text. Please check your connection.";
            status.innerText = "Offline or Connection Error";
        }
    }

    function resetChapterAndLoad() {
        currentBook = document.getElementById('bookSelect').value;
        currentChapter = 1;
        loadBible();
    }

    function changeChapter(step) {
        // Prevent chapter 0 or negative
        if (currentChapter + step < 1) return;
        
        currentChapter += step;
        loadBible();
    }

    // Initial load
    loadBible();
</script>

</body>
</html>
